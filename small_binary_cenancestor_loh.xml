<?xml version="1.0" standalone="yes"?>

<!-- Generated by BEAUTi v1.8.3 Prerelease r20150808                         -->
<!--       by Alexei J. Drummond, Andrew Rambaut and Marc A. Suchard         -->
<!--       Department of Computer Science, University of Auckland and        -->
<!--       Institute of Evolutionary Biology, University of Edinburgh        -->
<!--       David Geffen School of Medicine, University of California, Los Angeles-->
<!--       http://beast.bio.ed.ac.uk/                                        -->
<beast>

<taxa id="taxa">
<taxon id="A2000.00">
<date value="2000.00" direction="forwards" units="years"/>
</taxon>
<taxon id="B2000.00">
<date value="2000.00" direction="forwards" units="years"/>
</taxon>
<taxon id="C1995.00">
<date value="1995.00" direction="forwards" units="years"/>
</taxon>
<taxon id="D1995.00">
<date value="1995.00" direction="forwards" units="years"/>
</taxon>

                    </taxa>
                    <!-- The sequence alignment -->
                    <alignment id="alignment" dataType="binary">
<sequence>
<taxon idref="A2000.00"/>
00111000100000000010
</sequence>
<sequence>
<taxon idref="B2000.00"/>
00111001001000000000
</sequence>
<sequence>
<taxon idref="C1995.00"/>
00100000000111001000
</sequence>
<sequence>
<taxon idref="D1995.00"/>
00000000000111000100
</sequence>

                    </alignment>

                    <!-- The unique patterns for all positions                                   -->
                    <patterns id="patterns" from="1">
                    <alignment idref="alignment"/>
                    </patterns>

	<!-- A prior assumption that the population size has remained constant       -->
	<!-- throughout the time spanned by the genealogy.                           -->
	<constantSize id="constant" units="years">
		<populationSize>
			<parameter id="constant.popSize" value="3.33" lower="3.33" upper="3.33"/>
		</populationSize>
	</constantSize>

	<!-- Generate a random starting tree under the coalescent process            -->
	<coalescentSimulator id="startingTree">
		<taxa idref="taxa"/>
		<constantSize idref="constant"/>
	</coalescentSimulator>

	<!-- Generate a tree model added roothHeight                                  -->
	<treeModel id="treeModel" rootHeight="20.0">
		<coalescentTree idref="startingTree"/>
		<rootHeight>
			<parameter id="treeModel.rootHeight"/>
		</rootHeight>
		<nodeHeights internalNodes="true">
			<parameter id="treeModel.internalNodeHeights"/>
		</nodeHeights>
		<nodeHeights internalNodes="true" rootNode="true">
			<parameter id="treeModel.allInternalNodeHeights"/>
		</nodeHeights>
	</treeModel>

	<!-- Generate a coalescent likelihood                                        -->
	<coalescentLikelihood id="coalescent">
		<model>
			<constantSize idref="constant"/>
		</model>
		<populationTree>
			<treeModel idref="treeModel"/>
		</populationTree>
	</coalescentLikelihood>

	<!-- The strict clock (Uniform rates across branches)                        -->
<!-- 
	<strictClockBranchRates id="branchRates">
		<rate>
			<parameter id="clock.rate" value="1.0"/>
		</rate>
	</strictClockBranchRates>
 -->
	
	        <!-- The strict clock with 2 epochs (Uniform rates across branches)                        -->
        <rateEpochBranchRates id="branchRates">
                <rate>
                   <parameter id="anc.clock.rate" value="0.00118279760303503" lower="1.18279760303503e-07" upper="11.8279760303503"/>
                </rate>
                <epoch id="epoch1" transitionTime="5">
                   <parameter id="rec.clock.rate" value="0.00118279760303503" lower="1.18279760303503e-07" upper="11.8279760303503"/>
                </epoch>
        </rateEpochBranchRates>

	<lohModel id="loh_subsmodel">
		<frequencies>
			<frequencyModel dataType="binary">
                        	<alignment idref="alignment"/>
                                <frequencies>
                                	<parameter id="loh.frequencies" dimension="2"/>
                                </frequencies>
                        </frequencyModel>
                </frequencies>
                <alpha>
                	<parameter id="loh.alpha" value="0.00118279760303503" lower="1.18279760303503e-07" upper="11.8279760303503"/>
                </alpha>
                <beta>
                	<parameter id="loh.beta" value="0" lower="0" upper="0"/>
                </beta>
        </lohModel>

<!-- The Binary simple model (based on the general substitution model)       -->

<!-- Default Binary model
	
	<binarySubstitutionModel id="bsimple">
		<frequencies>
			<frequencyModel dataType="binary">
				<alignment idref="alignment"/>
				<frequencies>
					<parameter id="frequencies" dimension="2"/>
				</frequencies>
			</frequencyModel>
		</frequencies>
	</binarySubstitutionModel>
-->
	<!-- site model                                                              -->
	<siteModel id="siteModel">
		<substitutionModel>
<!-- Default Binary model

			<binarySubstitutionModel idref="bsimple"/>
-->
			<lohModel idref="loh_subsmodel"/>
		</substitutionModel>
	</siteModel>

	<!-- START Stochastic Dollo                                                  -->

	<!-- END Stochastic Dollo                                                    -->

	<cenancestorTreeLikelihood id="treeLikelihood" useAmbiguities="false">
		<patterns idref="patterns"/>
		<treeModel idref="treeModel"/>
		<siteModel idref="siteModel"/>
		<!-- Sequencing error: L(1|1)=1-alpha, L(0|1)=alpha L(0|0)=1-beta L(1|0)=beta
                <sequenceError1>
                      <parameter id="seqError1" value="6.3e-06" lower="6.3e-06" upper="6.3e-06"/>
                </sequenceError1>
                <sequenceError2>
                      <parameter id="seqError2" value="6.3e-06" lower="6.3e-06" upper="6.3e-06"/>
                </sequenceError2>-->
                <!-- Cenancestor, time going backwards in years -->
                <cenancestor>
                      <parameter id="luca" value="30.0" lower="30.0" upper="30.0"/>
                </cenancestor>
		<rateEpochBranchRates idref="branchRates"/>
	</cenancestorTreeLikelihood>

	<!-- Likelihood for tree given sequence data                                
	<treeLikelihood id="treeLikelihood" useAmbiguities="false">
		<patterns idref="patterns"/>
		<treeModel idref="treeModel"/>
		<siteModel idref="siteModel"/>
		<strictClockBranchRates idref="branchRates"/>
	</treeLikelihood>
										     -->
	<!-- Define operators                                                        -->
	<operators id="operators" optimizationSchedule="default">
		<scaleOperator scaleFactor="0.75" weight="3">
                        <parameter idref="loh.alpha"/>
        </scaleOperator>
		<scaleOperator scaleFactor="0.75" weight="3">
				<parameter idref="anc.clock.rate"/>
		</scaleOperator>
		<scaleOperator scaleFactor="0.75" weight="3">
				<parameter idref="rec.clock.rate"/>
		</scaleOperator>
		<subtreeSlide size="0.06" gaussian="true" weight="15">
			<treeModel idref="treeModel"/>
		</subtreeSlide>
		<narrowExchange weight="15">
			<treeModel idref="treeModel"/>
		</narrowExchange>
		<wideExchange weight="3">
			<treeModel idref="treeModel"/>
		</wideExchange>
		<wilsonBalding weight="3">
			<treeModel idref="treeModel"/>
		</wilsonBalding>
		<scaleOperator scaleFactor="0.75" weight="3">
			<parameter idref="treeModel.rootHeight"/>
		</scaleOperator>
		<uniformOperator weight="30">
			<parameter idref="treeModel.internalNodeHeights"/>
		</uniformOperator>
		<scaleOperator scaleFactor="0.75" weight="3">
			<parameter idref="constant.popSize"/>
		</scaleOperator>
		<upDownOperator scaleFactor="0.75" weight="3">
			<up>
                                <parameter idref="loh.alpha"/>
                        </up>
			<down>
				<parameter idref="treeModel.allInternalNodeHeights"/>
			</down>
		</upDownOperator>
		<upDownOperator scaleFactor="0.75" weight="3">
			<up>
					<parameter idref="anc.clock.rate"/>
			</up>
			<down>
					<parameter idref="treeModel.allInternalNodeHeights"/>
			</down>
        </upDownOperator>
        <upDownOperator scaleFactor="0.75" weight="3">
			<up>
					<parameter idref="rec.clock.rate"/>
			</up>
			<down>
					<parameter idref="treeModel.allInternalNodeHeights"/>
			</down>
        </upDownOperator>
	</operators>

	<!-- Define MCMC                                                             -->
	<mcmc id="mcmc" chainLength="20000000" autoOptimize="true" operatorAnalysis="my_test.ops">
		<posterior id="posterior">
			<prior id="prior">
                                <coalescentLikelihood idref="coalescent"/>
                                	<!-- Constrains root height, makes prior negative inf if root height gets beyond 50 -->
                                <uniformPrior lower="0.0" upper="20.0">
                                	<parameter idref="treeModel.rootHeight"/>
                                </uniformPrior>
<!--				<oneOnXPrior>
					<parameter idref="constant.popSize"/>
				</oneOnXPrior>-->
			</prior>
			<likelihood id="likelihood">
				<cenancestorTreeLikelihood idref="treeLikelihood"/>
			</likelihood>
		</posterior>
		<operators idref="operators"/>

		<!-- write log to screen                                                     -->
		<log id="screenLog" logEvery="1000">
			<column label="Posterior" dp="4" width="12">
				<posterior idref="posterior"/>
			</column>
			<column label="Prior" dp="4" width="12">
				<prior idref="prior"/>
			</column>
			<column label="Likelihood" dp="4" width="12">
				<likelihood idref="likelihood"/>
			</column>
			<column label="loh.alpha" sf="6" width="12">
				<parameter idref="loh.alpha"/>
			</column>
			<column label="rootHeight" sf="6" width="12">
				<parameter idref="treeModel.rootHeight"/>
			</column>
			<column label="anc.clock.rate" sf="6" width="12">
				<parameter idref="anc.clock.rate"/>
			</column>
			<column label="rec.clock.rate" sf="6" width="12">
				<parameter idref="rec.clock.rate"/>
			</column>
		</log>

		<!-- write log to file                                                       -->
		<log id="fileLog" logEvery="1000" fileName="my_test.log" overwrite="false">
			<posterior idref="posterior"/>
			<prior idref="prior"/>
			<likelihood idref="likelihood"/>
			<parameter idref="loh.alpha"/>
			<parameter idref="treeModel.rootHeight"/>
			<parameter idref="constant.popSize"/>
			<parameter idref="anc.clock.rate"/>
			<parameter idref="rec.clock.rate"/>
			<parameter idref="treeModel.rootHeight"/>
			<parameter idref="luca"/>

			<!-- START Stochastic Dollo                                                  -->

			<!-- END Stochastic Dollo                                                    -->

			<cenancestorTreeLikelihood idref="treeLikelihood"/>
			<coalescentLikelihood idref="coalescent"/>
		</log>

		<!-- write tree log to file                                                  -->
		<logTree id="treeFileLog" logEvery="1000" nexusFormat="true" fileName="my_test.trees" sortTranslationTable="true">
			<treeModel idref="treeModel"/>
			<trait name="rate" tag="rate">
				<strictClockBranchRates idref="branchRates"/>
			</trait>
			<posterior idref="posterior"/>
		</logTree>
	</mcmc>
	<report>
		<property name="timer">
			<mcmc idref="mcmc"/>
		</property>
	</report>
</beast>
